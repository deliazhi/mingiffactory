<!DOCTYPE html><html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>动图小工厂</title> <meta name="viewport" content="width=device-width, initial-scale=1"> <script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script> <script src="https://cdn.bootcss.com/bootstrap/4.1.0/js/bootstrap.min.js"></script> <script src="https://cdn.bootcss.com/fabric.js/2.3.0/fabric.min.js"></script> <script src="https://cdn.bootcss.com/downloadjs/1.4.7/download.min.js"></script> <script src="https://cdn.bootcss.com/keypress/2.1.5/keypress.min.js"></script> <script src="https://cdn.bootcss.com/gif.js/0.2.0/gif.js"></script> <link rel="stylesheet" type="text/css" media="screen" href="/main.b072e939.css"> <link href="https://cdn.bootcss.com/bootstrap/4.1.0/css/bootstrap.min.css" rel="stylesheet"> </head> <body> <div class="container-fluid"> <div class="row"> <nav class="col-md-2 d-none d-md-block bg-light sidebar"> <div class="sidebar-sticky"> </div> </nav> <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4"> <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"> <h1 class="h2">动图小工厂</h1> </div> <canvas class="w-100" id="myAvatar" width="460" height="460"></canvas> <div> <button class="btn btn-primary" onclick="downloadit()">下载图片</button> <button class="btn btn-outline-secondary" onclick="debug()">调试</button> <button class="btn btn-outline-secondary" onclick="pic_add()">加入动图序列</button> <button class="btn btn-outline-secondary" onclick="pic_build()">下载动图</button> </div> <div class="form-group editBar"> <input type="text" class="form-control" id="theText" placeholder="点击画布中的文字进行修改" disabled onchange="update_text()"> </div> <ul class="gif-images"> </ul> </main> </div> </div> <script>var canvas=new fabric.Canvas("myAvatar",{preserveObjectStacking:!0});canvas.backgroundColor="rgba(255,255,255,1)",fabric.Image.fromURL("avatar.png",function(e){canvas.insertAt(e,0)}),fabric.Image.fromURL("github.png",function(e){canvas.insertAt(e,1),e.set("top",48),e.set("left",69),e.set("angle",338),e.set("scaleX",.45),e.set("scaleY",.45),e.set({cornerSize:15,padding:5,transparentCorners:!0,cornerStyle:"circle",cornerColor:"red",borderColor:"red"})});var text=new fabric.Text("hello world",{top:100,left:100});function text_init(){$(canvas.getObjects()).each((e,t)=>{"text"==t.type&&t.on("selected",()=>{$("#theText").val(t.text),$("#theText").prop("disabled",!1)})})}function update_text(){var e=$("#theText").val();if(e.length>0){var t=canvas.getActiveObject();t&&"text"==t.type&&(t.set("text",e),canvas.renderAll())}}function downloadit(){download(canvas.toDataURL("png"),"avatar.png","image/png")}function debug(){var e=canvas.getActiveObject();void 0!=e&&(console.log("top="+e.top),console.log("left="+e.left),console.log("angle="+e.angle),console.log("scaleX="+e.scaleX),console.log("scaleY="+e.scaleY))}function pic_add(){var e=canvas.toDataURL("png"),t=$(" <li> <img src='"+e+"'/> </li>");$(".gif-images").append(t)}function pic_build(){var e=new GIF({workers:2,quality:10,width:460,height:460});$(".gif-images li img").each((t,a)=>{e.addFrame(a,{delay:1e3})}),e.on("finished",function(e){download(e,"avatar.gif","image/gif")}),e.render()}canvas.insertAt(text,2),text.set("top",156),text.set("left",126),text.set("angle",341),text.set("fill","white"),text.set({cornerSize:15,padding:5,transparentCorners:!0,cornerStyle:"circle",cornerColor:"red",borderColor:"red"}),$(function(){var e=new window.keypress.Listener;e.simple_combo("shift s",function(){console.log("You pressed shift and s");var e=canvas.getActiveObject();e&&canvas.remove(e)}),e.simple_combo("]",function(){var e=canvas.getActiveObject();e&&canvas.sendBackwards(e)}),e.simple_combo("[",function(){var e=canvas.getActiveObject();e&&canvas.bringForward(e)}),text_init()});</script> </body> </html>